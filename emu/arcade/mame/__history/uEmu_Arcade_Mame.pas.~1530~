unit uEmu_Arcade_Mame;

interface

uses
  System.Classes,
  System.SysUtils,
  FMX.Forms,
  FMX.Types,
  OXmlPDOM;

procedure uEmu_Arcade_Mame_Load;
procedure uEmu_Arcade_Mame_Loading;
procedure uEmu_Arcade_Mame_Display_Main;

Procedure uEmu_Arcade_Mame_Exit;

implementation

uses
  uLoad_AllTypes,
  uEmu_Actions,
  uEmu_Arcade_Mame_SetAll,
  uEmu_Arcade_Mame_AllTypes,
  uEmu_Arcade_Mame_Game_SetAll,
  uEmu_Arcade_Mame_Support_Files,
  uEmu_Arcade_Mame_Ini,
  uEmu_Arcade_Mame_Gamelist,
  uEmu_Arcade_Mame_Actions,
  uEmu_Arcade_Mame_Filters,
  uEmu_Arcade_Mame_Config,
  uEmu_Arcade_Mame_Config_Directories,
  uEmu_Arcade_Mame_Config_Display,
  uEmu_Arcade_Mame_Config_Advanced,
  uEmu_Arcade_Mame_Config_Screen,
  uEmu_Arcade_Mame_Config_OpenGL_BGFX,
  uEmu_Arcade_Mame_Config_OpenGLShaders,
  uEmu_Arcade_Mame_Config_Vector,
  uEmu_Arcade_Mame_Config_Sound,
  uEmu_Arcade_Mame_Config_Controllers,
  uEmu_Arcade_Mame_Config_Controller_Mapping,
  uEmu_Arcade_Mame_Config_Miscellaneous,
  uEmu_Arcade_Mame_Config_MiscellaneousII,
  uEmu_Arcade_Mame_Config_Snap_Movie_Playback;

procedure uEmu_Arcade_Mame_Loading;
begin
  Application.ProcessMessages;
  uEmu_Arcade_Mame_Ini_Load;
  uEmu_Arcade_Mame_Ini_GetMediaPaths;
  // mame.Gamelist.Games:= CreateXMLDoc;
  // mame.Gamelist.Games.LoadFromFile(mame.Prog.Data_Path+ mame.Prog.Games_XML);
end;

procedure uEmu_Arcade_Mame_Load;
var
  vi: integer;
begin
  extrafe.prog.State := 'mame_';
  emulation.Active_Num := 0;

  // Timers
  mame.Timers.Gamelist := TEMU_GAMELISTS_TIMER.Create(vMame.Scene.Main);
  mame.Timers.Video := TEMU_VIDEO_TIMER.Create(vMame.Scene.Main);

  // Animations
  mame.Ani.Gamelist := TEMU_GAMELISTS_ANIMATION.Create;

  // Gamelist
  mame.Gamelist.Timer := TTimer.Create(vMame.Scene.Main);
  mame.Gamelist.Timer.Interval := 500;
  mame.Gamelist.Timer.Enabled := False;
  mame.Gamelist.Timer.OnTimer := mame.Timers.Gamelist.OnTimer;

  // Create Main Scene
  uEmu_Arcade_Mame_Filters_Ini;
  uEmu_Arcade_Mame_Filters_Load_Filter(mame.Prog.Filter);

  // Nplayers support
  mame.Support.NPlayers_Roms := TStringList.Create;
  mame.Support.NPlayers_Players := TStringList.Create;
  // Catver files support
  mame.Support.CatVer_Roms := TStringList.Create;
  mame.Support.CatVer_Cat := TStringList.Create;
  mame.Support.CatVer_Added := TStringList.Create;

  uEmu_Arcade_Mame_Support_Files_NPlayers_Load;
  uEmu_Arcade_Mame_Support_Files_Catver_Load;
  uEmu_Arcade_Mame_SetAll_Set;
  uEmu_Arcade_Mame_Display_Main;
{  // Configuration
  // Header
  uEmu_Arcade_Mame_Config_Create_Header;
  // Config buttons
  uEmu_Arcade_Mame_Config_Create_Buttons;
  // Config Actions
  uEmu_Arcade_Mame_Config_Create_Actions_Panel;
  uEmu_Arcade_Mame_Config_Create_Directories_Panel;
  uEmu_Arcade_Mame_Config_Create_Display_Panel;
  uEmu_Arcade_Mame_Config_Create_Advanced_Panel;
  uEmu_Arcade_Mame_Config_Create_Screen_Panel;
  uEmu_Arcade_Mame_Config_Create_OpenGL_BGFX_Panel;
  uEmu_Arcade_Mame_Config_Create_OpenGL_Shaders_Panel;
  uEmu_Arcade_Mame_Config_Create_Vector_Panel;
  uEmu_Arcade_Mame_Config_Create_Sound_Panel;
  uEmu_Arcade_Mame_Config_Create_Controllers_Panel;
  uEmu_Arcade_Mame_Config_Create_ControllerMapping_Panel;
  uEmu_Arcade_Mame_Config_Create_Miscellaneous_Panel;
  uEmu_Arcade_Mame_Config_Create_MiscellaneousII_Panel;
  uEmu_Arcade_Mame_Config_Create_Snap_Movie_Playback_Panel;
end;

procedure uEmu_Arcade_Mame_Display_Main;
var
  vi, ti, ri: integer;
  iPos: integer;
  vName: string;
  romName: String;
  vGamesInfoCount: String;
begin
  mame.Gamelist.Selected := 0;
  uEmu_Arcade_Mame_Gamelist_Refresh;
  vGamesInfoCount := IntToStr(mame.Gamelist.Selected + 1) + '/' + IntToStr(mame.Gamelist.Games_Count);
  vMame.Scene.Gamelist.T_Games_Count_Info.Text := vGamesInfoCount;
  mame.Main.SnapCategory := 'Video Snaps';
  mame.Main.SnapMode := 'arcade';
  mame.Main.SnapCategory_Num := 0;
  uEmu_Arcade_Mame_Actions_ShowData;
end;

Procedure uEmu_Arcade_Mame_Exit;
begin
  FreeAndNil(vMame.Scene.Main);
  mame.Support.ClearSupport;
  extrafe.prog.State := 'main';
  uEmu_Actions_Exit;
end;

end.
